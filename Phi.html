<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixpunkte Visualisierung</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Noto Sans für UI, Times für Mathe -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans', sans-serif; }
        .math-font { font-family: 'Times New Roman', Times, serif; font-style: italic; }
        /* Smooth Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Inline SVG Components for Zero Dependencies) ---
        const IconPlay = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        );
        const IconPause = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
        );
        const IconRefresh = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 21H3v-5"></path></svg>
        );
        const IconGitFork = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v1a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V9"></path><path d="M12 12v3"></path></svg>
        );

        // --- TYPOGRAPHY COMPONENT ---
        const M = ({ children, className = "" }) => (
            <span className={`math-font text-lg ${className}`}>
                {children}
            </span>
        );

        // --- MAIN APP COMPONENT ---
        const FixpointTree = () => {
            const [slope, setSlope] = useState(0.5); 
            const [startX, setStartX] = useState(0.5);
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentStep, setCurrentStep] = useState(0);

            const iterations = 30;
            const fixX = 2;
            const fixY = 2;
            const range = 4;
            const size = 280; 

            useEffect(() => {
                let interval;
                if (isPlaying) {
                    interval = setInterval(() => {
                        setCurrentStep(prev => {
                            if (prev >= iterations) {
                                setIsPlaying(false);
                                return 0; 
                            }
                            return prev + 1;
                        });
                    }, 200);
                }
                return () => clearInterval(interval);
            }, [isPlaying]);

            // Logic Helpers
            const absSlope = Math.abs(slope);
            const isAttracting = absSlope < 1;
            const isRepelling = absSlope > 1;
            const isMonotone = slope >= 0;
            const isOscillating = slope < 0;

            // Plotting Helper
            const generatePath = (m, x0) => {
                const path = [];
                let x = x0;
                path.push({ x: x, y: 0 }); 
                for (let i = 0; i < iterations; i++) {
                    const nextY = m * (x - fixX) + fixY;
                    if (Math.abs(nextY) > 50 || Math.abs(x) > 50) break; 
                    path.push({ x: x, y: nextY }); 
                    path.push({ x: nextY, y: nextY }); 
                    x = nextY;
                }
                return path;
            };

            const toSvg = (val) => (val / range) * size;
            const toSvgY = (val) => size - (val / range) * size;

            // Mini Plot Component
            const MiniPlot = ({ m, active, label }) => {
                const localPath = generatePath(m, 0.5); 
                const strokeColor = active ? (Math.abs(m) < 1 ? '#10b981' : '#ef4444') : '#cbd5e1'; 
                const funcColor = active ? (m >= 0 ? '#3b82f6' : '#8b5cf6') : '#94a3b8';

                return (
                    <div className={`transition-all duration-500 bg-white rounded-lg border-2 p-2 flex flex-col items-center ${active ? 'border-slate-800 shadow-lg scale-105 ring-2 ring-indigo-100' : 'border-slate-100 opacity-60 grayscale'}`}>
                        <div className="relative w-32 h-32 mb-2">
                           <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full overflow-hidden">
                             <line x1="0" y1={size} x2={size} y2={size} stroke="#333" strokeWidth="2" />
                             <line x1="0" y1={0} x2={0} y2={size} stroke="#333" strokeWidth="2" />
                             <line x1="0" y1={size} x2={size} y2={0} stroke="#e2e8f0" strokeWidth="2" strokeDasharray="4" />
                             <line 
                                x1={0} y1={toSvgY(m * (0 - fixX) + fixY)} 
                                x2={size} y2={toSvgY(m * (range - fixX) + fixY)} 
                                stroke={funcColor} strokeWidth="3" 
                             />
                             {active && localPath.slice(0, 8).map((p, i, arr) => {
                               if(i===0) return null;
                               return <line key={i} x1={toSvg(arr[i-1].x)} y1={toSvgY(arr[i-1].y)} x2={toSvg(p.x)} y2={toSvgY(p.y)} stroke={strokeColor} strokeWidth="2" />
                             })}
                           </svg>
                        </div>
                        <div className="text-center">
                            {label}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen pb-12">
                  
                  {/* --- Navbar / Controls --- */}
                  <div className="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 shadow-sm px-4 py-3">
                    <div className="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6">
                      <div className="flex flex-col w-full md:w-1/2">
                         <label className="flex justify-between text-sm font-bold text-slate-600 mb-2 items-center">
                            <span>Steigung <M>φ'(x)</M> setzen:</span>
                            <span className={`px-3 py-0.5 rounded-full text-sm font-mono ${isAttracting ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              m = {slope.toFixed(2)}
                            </span>
                         </label>
                         <input 
                            type="range" min="-2.5" max="2.5" step="0.1" 
                            value={slope}
                            onChange={(e) => { setSlope(parseFloat(e.target.value)); setIsPlaying(false); setCurrentStep(0); }}
                         />
                         <div className="flex justify-between text-[10px] text-slate-400 mt-1 px-1 font-mono">
                           <span>-2.5</span>
                           <span>0</span>
                           <span>2.5</span>
                         </div>
                      </div>

                      <div className="flex items-center gap-4">
                         <div className="text-right hidden md:block leading-tight">
                           <div className="text-[10px] text-slate-500 uppercase tracking-wider font-bold">Zustand</div>
                           <div className="math-font text-lg text-slate-800">
                             {isAttracting ? 'Anziehend' : 'Abstoßend'}, {isMonotone ? 'Monoton' : 'Oszillierend'}
                           </div>
                         </div>
                         <button 
                           onClick={() => setIsPlaying(!isPlaying)}
                           className="bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 transition shadow-lg flex items-center justify-center w-10 h-10 md:w-12 md:h-12"
                         >
                           {isPlaying ? <IconPause size={20} /> : <IconPlay size={20} className="ml-1" />}
                         </button>
                         <button 
                           onClick={() => {setCurrentStep(0); setIsPlaying(false);}}
                           className="bg-white text-slate-600 border border-slate-200 p-2 rounded-full hover:bg-slate-50 transition shadow-sm w-10 h-10 md:w-12 md:h-12 flex items-center justify-center"
                         >
                           <IconRefresh size={20} />
                         </button>
                      </div>
                    </div>
                  </div>

                  <main className="max-w-6xl mx-auto p-4 md:p-8">
                    
                    {/* --- TITLE --- */}
                    <div className="text-center mb-12 mt-4">
                        <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Klassifikation von Fixpunkten</h1>
                        <p className="text-slate-500 max-w-2xl mx-auto">Interaktive Visualisierung der Konvergenzverhaltens bei <M>x_{"{n+1}"} = φ(x_n)</M></p>
                    </div>

                    {/* --- TREE VISUALIZATION --- */}
                    <div className="flex flex-col items-center gap-6 mb-16 relative">
                       
                       {/* Root Node */}
                       <div className="z-10 bg-slate-800 text-white px-8 py-3 rounded-xl shadow-xl text-xl font-bold font-serif relative">
                         Fixpunkte <M>x^*</M>
                         <div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-slate-800 rotate-45"></div>
                       </div>

                       {/* Branch Connections */}
                       <div className="w-full max-w-3xl h-12 flex justify-center items-end px-4 md:px-20 relative -mt-2 -z-10">
                          <div className={`w-1/2 h-full border-t-2 border-r-2 rounded-tr-3xl transition-all duration-300 ${isAttracting ? 'border-slate-800 border-b-0' : 'border-slate-200 border-dashed'}`} style={{transform: 'skewX(-15deg)', marginRight: '4px'}}></div>
                          <div className={`w-1/2 h-full border-t-2 border-l-2 rounded-tl-3xl transition-all duration-300 ${isRepelling ? 'border-slate-800 border-b-0' : 'border-slate-200 border-dashed'}`} style={{transform: 'skewX(15deg)', marginLeft: '4px'}}></div>
                       </div>

                       {/* Level 1: Main Branches */}
                       <div className="grid grid-cols-2 gap-4 md:gap-24 w-full max-w-5xl">
                          
                          {/* Left Branch (Attracting) */}
                          <div className={`flex flex-col items-center transition-opacity duration-500 ${isAttracting ? 'opacity-100' : 'opacity-40 grayscale'}`}>
                             <div className="bg-white border-2 border-slate-800 px-4 py-3 rounded-xl text-center shadow-sm w-full max-w-xs relative">
                                <h3 className="font-bold text-lg mb-1 text-slate-800">anziehend</h3>
                                <p className="text-xs text-slate-500 mb-2 italic">Konvergenz in Umgebung</p>
                                <div className="inline-block bg-green-50 text-green-800 px-3 py-1 rounded border border-green-200 text-sm font-bold">
                                  <M>|φ'(x)| &lt; 1</M>
                                </div>
                             </div>
                             
                             {/* Sub-Branch Connector */}
                             <div className="h-8 w-24 flex justify-between relative mt-1">
                                 <div className={`absolute left-0 top-0 w-1/2 h-full border-r-2 border-slate-300 ${isAttracting && isMonotone ? '!border-slate-800' : ''}`} style={{ transform: 'skewX(25deg)'}}></div>
                                 <div className={`absolute right-0 top-0 w-1/2 h-full border-l-2 border-slate-300 ${isAttracting && isOscillating ? '!border-slate-800' : ''}`} style={{ transform: 'skewX(-25deg)'}}></div>
                             </div>

                             <div className="grid grid-cols-2 gap-2 mt-1 w-full">
                                <MiniPlot m={0.5} active={isAttracting && isMonotone} label={<div className="text-xs"><span className="font-bold block">monoton</span><M>0 ≤ φ' &lt; 1</M></div>} />
                                <MiniPlot m={-0.6} active={isAttracting && isOscillating} label={<div className="text-xs"><span className="font-bold block">oszillierend</span><M>-1 &lt; φ' ≤ 0</M></div>} />
                             </div>
                          </div>

                          {/* Right Branch (Repelling) */}
                          <div className={`flex flex-col items-center transition-opacity duration-500 ${isRepelling ? 'opacity-100' : 'opacity-40 grayscale'}`}>
                             <div className="bg-white border-2 border-slate-800 px-4 py-3 rounded-xl text-center shadow-sm w-full max-w-xs">
                                <h3 className="font-bold text-lg mb-1 text-slate-800">abstoßend</h3>
                                <p className="text-xs text-slate-500 mb-2 italic">Keine lokale Konvergenz</p>
                                <div className="inline-block bg-red-50 text-red-800 px-3 py-1 rounded border border-red-200 text-sm font-bold">
                                  <M>|φ'(x)| &gt; 1</M>
                                </div>
                             </div>

                             {/* Sub-Branch Connector */}
                             <div className="h-8 w-24 flex justify-between relative mt-1">
                                 <div className={`absolute left-0 top-0 w-1/2 h-full border-r-2 border-slate-300 ${isRepelling && isMonotone ? '!border-slate-800' : ''}`} style={{ transform: 'skewX(25deg)'}}></div>
                                 <div className={`absolute right-0 top-0 w-1/2 h-full border-l-2 border-slate-300 ${isRepelling && isOscillating ? '!border-slate-800' : ''}`} style={{ transform: 'skewX(-25deg)'}}></div>
                             </div>

                             <div className="grid grid-cols-2 gap-2 mt-1 w-full">
                                <MiniPlot m={1.5} active={isRepelling && isMonotone} label={<div className="text-xs"><span className="font-bold block">monoton</span><M>φ' &gt; 1</M></div>} />
                                <MiniPlot m={-1.5} active={isRepelling && isOscillating} label={<div className="text-xs"><span className="font-bold block">oszillierend</span><M>φ' &lt; -1</M></div>} />
                             </div>
                          </div>

                       </div>
                    </div>

                    {/* --- DETAIL SIMULATION --- */}
                    <div className="bg-white rounded-2xl shadow-xl border border-slate-200 p-6 md:p-8 max-w-4xl mx-auto mt-12">
                        <div className="flex items-center gap-3 mb-6 border-b border-slate-100 pb-4">
                            <div className={`p-2 rounded-lg ${isAttracting ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                <IconGitFork size={24} />
                            </div>
                            <div>
                                <h2 className="text-xl md:text-2xl font-bold text-slate-800">Detailansicht: Spinnweb-Diagramm</h2>
                                <p className="text-slate-500 text-sm">Aktuelle Steigung <M>m = {slope}</M></p>
                            </div>
                        </div>

                        <div className="flex flex-col md:flex-row gap-8">
                            {/* Main SVG Area */}
                            <div className="flex-1 aspect-square max-h-[450px] relative bg-slate-50 rounded-lg border border-slate-200 overflow-hidden shadow-inner">
                                 <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-full">
                                    <defs>
                                        <pattern id="grid" width="28" height="28" patternUnits="userSpaceOnUse">
                                            <path d="M 28 0 L 0 0 0 28" fill="none" stroke="#e2e8f0" strokeWidth="1"/>
                                        </pattern>
                                    </defs>
                                    <rect width="100%" height="100%" fill="url(#grid)" />
                                    
                                    <line x1="0" y1={size} x2={size} y2={size} stroke="#64748b" strokeWidth="2" />
                                    <line x1="0" y1={0} x2={0} y2={size} stroke="#64748b" strokeWidth="2" />
                                    
                                    <line x1="0" y1={size} x2={size} y2={0} stroke="#cbd5e1" strokeWidth="2" strokeDasharray="6,4" />
                                    <text x={size-35} y={35} className="fill-slate-400 text-xs italic font-serif">y = x</text>

                                    <line 
                                        x1={0} 
                                        y1={toSvgY(slope * (0 - fixX) + fixY)} 
                                        x2={size} 
                                        y2={toSvgY(slope * (range - fixX) + fixY)} 
                                        stroke={isAttracting ? '#10b981' : '#ef4444'} 
                                        strokeWidth="3" 
                                    />
                                    <text x={20} y={toSvgY(slope * (0.5 - fixX) + fixY) - 15} className="fill-slate-700 font-bold text-sm font-serif italic">y = φ(x)</text>

                                    <circle cx={toSvg(fixX)} cy={toSvgY(fixY)} r="5" fill="#1e293b" />

                                    {generatePath(slope, startX).slice(0, currentStep * 2 + 2).map((point, i, arr) => {
                                        if (i === 0) return null;
                                        const prev = arr[i-1];
                                        return (
                                            <line 
                                            key={i}
                                            x1={toSvg(prev.x)} 
                                            y1={toSvgY(prev.y)} 
                                            x2={toSvg(point.x)} 
                                            y2={toSvgY(point.y)} 
                                            stroke="#4f46e5" 
                                            strokeWidth="2"
                                            opacity="0.8"
                                            />
                                        );
                                    })}
                                    
                                    {/* Current Point Dot */}
                                    {currentStep > 0 && generatePath(slope, startX)[Math.min(generatePath(slope, startX).length-1, currentStep*2)] && (
                                       <circle 
                                         cx={toSvg(generatePath(slope, startX)[Math.min(generatePath(slope, startX).length-1, currentStep*2)].x)}
                                         cy={toSvgY(generatePath(slope, startX)[Math.min(generatePath(slope, startX).length-1, currentStep*2)].y)}
                                         r="6" fill="#4f46e5" className="animate-pulse"
                                       />
                                    )}
                                 </svg>
                            </div>
                            
                            {/* Side Panel */}
                            <div className="w-full md:w-64 flex flex-col gap-4">
                                 <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 shadow-sm">
                                    <h4 className="font-bold text-sm text-slate-700 mb-3">Startwert <M>x_0</M> ändern</h4>
                                    <input 
                                        type="range" min="0" max="4" step="0.1"
                                        value={startX}
                                        onChange={(e) => { setStartX(parseFloat(e.target.value)); setCurrentStep(0); setIsPlaying(false); }}
                                        className="w-full"
                                    />
                                    <div className="text-right text-xs text-slate-500 font-mono mt-1">{startX.toFixed(1)}</div>
                                 </div>
                                 
                                 <div className={`flex-1 p-4 rounded-lg border text-sm leading-relaxed ${isAttracting ? 'bg-green-50 border-green-200 text-green-900' : 'bg-red-50 border-red-200 text-red-900'}`}>
                                    <strong className="block mb-2 text-xs uppercase tracking-wide opacity-80">Beobachtung</strong>
                                    {isAttracting 
                                      ? isMonotone 
                                         ? <span>Da <M>0 \le m &lt; 1</M>, nähert sich die Folge dem Schnittpunkt in "Treppenstufen" an (monotone Konvergenz).</span>
                                         : <span>Da <M>-1 &lt; m \le 0</M>, nähert sich die Folge dem Schnittpunkt spiralförmig an (oszillierende Konvergenz).</span>
                                      : isMonotone
                                         ? <span>Da <M>m &gt; 1</M>, wachsen die Treppenstufen immer weiter an. Die Folge entfernt sich vom Fixpunkt.</span>
                                         : <span>Da <M>m &lt; -1</M>, wird die Spirale immer größer. Die Folge wird "herausgeschleudert".</span>
                                    }
                                 </div>
                            </div>
                        </div>
                    </div>

                  </main>
                  
                  <footer className="text-center text-slate-400 text-xs py-8">
                     Visualisierung erstellt mit React & Tailwind CSS
                  </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FixpointTree />);
    </script>
</body>
</html>


